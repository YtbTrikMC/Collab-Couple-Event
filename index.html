<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tool Vi·ªát H√≥a XML</title>
</head>
<body>
  <h2>Tool Vi·ªát H√≥a File XML (CreoStrings.xml)</h2>
  <input type="file" id="fileInput" />
  <button id="translateBtn">D·ªãch sang Ti·∫øng Vi·ªát</button>
  <a id="downloadLink" style="display:none;">T·∫£i file d·ªãch</a>

  <script>
    async function translateText(text) {
      const res = await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=" + encodeURIComponent(text));
      const data = await res.json();
      return data[0].map(x => x[0]).join("");
    }

    document.getElementById("translateBtn").addEventListener("click", async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Vui l√≤ng ch·ªçn file XML tr∆∞·ªõc!");
        return;
      }

      const text = await file.text();
      let output = text;

      // Regex t√¨m c√°c chu·ªói trong th·∫ª <string>
      const regex = /<string name="([^"]+)">([\s\S]*?)<\/string>/g;
      const matches = [...text.matchAll(regex)];

      for (let match of matches) {
        const original = match[2];
        if (original.trim() === "") continue;
        const translated = await translateText(original);
        output = output.replace(original, translated);
      }

      // Xu·∫•t file XML m·ªõi
      const blob = new Blob([output], { type: "text/xml" });
      const url = URL.createObjectURL(blob);
      const link = document.getElementById("downloadLink");
      link.href = url;
      link.download = "CreoStrings_vi.xml";
      link.style.display = "block";
      link.textContent = "üëâ T·∫£i file CreoStrings_vi.xml";
    });
  </script>
</body>
</html>
